<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    </head>

    <body>
        <form onsubmit="return validate()" name="myForm" action="/department/saving" method="post">
            Enter the department : <input type="text" name="departmentName" id="departmentName"><br>
            Enter the department Id : <input type="text" name="departmentId" id="department_Id"><br>
            Select the company : <select id="company-option" name="departmentCompanyId">
                <option>-------</option>
            </select><br> 
            <input type="submit" value="Click to submit">
        </form>
        <script>
            function validate() {
                var departmentName = document.myForm.departmentName.value;
                var departmentId = document.myForm.departmentId.value;
                var departmentCompanyId = document.myForm.departmentCompanyId.value;
                if (departmentName == "") {
                    alert("Department name can't be empty");
                    document.myForm.departmentName.focus();
                    return false;
                }
                if (departmentId == "") {
                    alert("Department id cant be empty");
                    document.myForm.departmentId.value;
                    return false;
                }
                if (departmentCompanyId == "") {
                    alert("No company is selected");
                    return false;
                }
                if (!/^[a-zA-Z .]+$/.test(departmentName)) {
                    alert("Department name is invalid");
                    document.myForm.dName.focus();
                    return false;
                }
                if (!/^[D][-][0-9]{3}$/.test(departmentId)) {
                    alert("Department code is invalid (eg : D-XXX)");
                    document.myForm.dCode.focus();
                    return false;
                }
                document.myForm.departmentName.value = departmentName.trim().toLowerCase();
                document.myForm.departmentId.value = departmentId.trim();
                return true;
            }

            $(document).ready(function () {

                var json = {
                    "attribute": "companyId"
                };
                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    url: "/company/loadAllCompany",
                    data: JSON.stringify(json),
                    success: function (data) {
                        var html = '';
                        var len = data.length;
                        html += '<option value=""></option>';
                        for (var i = 0; i < len; i++) {
                            html += '<option value="' + data[i].companyId + '">'
                                    + data[i].companyName
                                    + '</option>';
                        }
                        $('#company-option').html(html);
                    },
                    error : function(e){
                   
                        console.log(e)
                    }
                    
                       
                    });
                     
                });

                $("#departmentName").change(function () {
                    var attribute = $(this).val();

                    var json = {
                        "attribute": attribute
                    };
                    $.ajax({
                        type: "POST",
                        contentType: "application/json",
                        url: "/department/checkDepartmentName",
                        data: JSON.stringify(json),
                        success: function (data) {
                            if (data == "NOT FOUND") {
                                $("#department_Id").attr("readonly", false);
                                $("#department_Id").attr("value", "Not Found");

                            } else {
                                $("#department_Id").attr("readonly", false);
                                $("#department_Id").attr("value", data);
                                $("#department_Id").attr("readonly", true);

                            }
                        },
                        error: function (e) {
              
                            console.log(e);
                        }

                    });

                });
            
        </script>
    </body>

</html>